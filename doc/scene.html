<!DOCTYPE html>  <html> <head>   <title>scene.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="icon" type="image/x-icon" href="http://spinnychair.co.cc/img/favicon.ico">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="aiscripts.html">                 aiscripts.coffee               </a>                                           <a class="source" href="audio.html">                 audio.coffee               </a>                                           <a class="source" href="cutscene.html">                 cutscene.coffee               </a>                                           <a class="source" href="engine.html">                 engine.coffee               </a>                                           <a class="source" href="format.html">                 format.coffee               </a>                                           <a class="source" href="load.html">                 load.coffee               </a>                                           <a class="source" href="pause.html">                 pause.coffee               </a>                                           <a class="source" href="save.html">                 save.coffee               </a>                                           <a class="source" href="scene.html">                 scene.coffee               </a>                                           <a class="source" href="scenenode.html">                 scenenode.coffee               </a>                                           <a class="source" href="sound.html">                 sound.coffee               </a>                                           <a class="source" href="sprite.html">                 sprite.coffee               </a>                                           <a class="source" href="surface.html">                 surface.coffee               </a>                                           <a class="source" href="sysinf.html">                 sysinf.coffee               </a>                                           <a class="source" href="tile.html">                 tile.coffee               </a>                                           <a class="source" href="unit.html">                 unit.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <a id="ribbon" href="https://github.com/DarthFennec"><img src="http://spinnychair.co.cc/img/forkme.png" /></a>             <h1>               scene.coffee             </h1>           </th>           <th class="code">             <h1>               <a id="title" href="http://spinnychair.co.cc">Spinny Chair</a>             </h1>           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>The conventional scene system.</strong></p>

<p>This class is built to handle conventional "walking around" scenes.
A scene is simply a list of <a href="sprite.html">sprites</a>, and/or sprite-like
objects such as <a href="tile.html">tile maps</a>. Normally, there is one tilemap,
which should be placed at the end of the list. Also, the first sprite in
the list will be the scene focus, and can be controlled with the keyboard.
Any other sprites in the scene should be placed between these two.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">scenehandler</span>
  <span class="nv">constructor: </span><span class="o">-&gt;</span> <span class="vi">@currscene = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Initialize or reinitialize the scene, given a new sprite list. Pass 0 to remove the scene.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="nf">(@currscene) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Render all the sprites, after solving all AI and collisions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="nf">(buffer) -&gt;</span>
    <span class="k">if</span> <span class="nx">@currscene</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">@currscene</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">passive</span>
        <span class="nx">scene</span><span class="p">.</span><span class="nx">docollide</span> <span class="nx">sprite</span> <span class="k">for</span> <span class="nx">scene</span> <span class="k">in</span> <span class="nx">@currscene</span> <span class="k">when</span> <span class="nx">sprite</span> <span class="o">isnt</span> <span class="nx">scene</span>
        <span class="nx">sprite</span><span class="p">.</span><span class="nx">aiscript</span> <span class="nx">@currscene</span> <span class="k">if</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">aiscript</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="nv">f = </span><span class="p">(</span><span class="k">new</span> <span class="nx">vect</span><span class="p">).</span><span class="nx">l</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">@currscene</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">area</span><span class="p">.</span><span class="nx">p</span><span class="p">.</span><span class="nx">i</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">@currscene</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">area</span><span class="p">.</span><span class="nx">s</span><span class="p">.</span><span class="nx">i</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">-</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">dims</span><span class="p">.</span><span class="nx">i</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
      <span class="nx">sprite</span><span class="p">.</span><span class="nx">step</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">f</span> <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">@currscene</span>
      <span class="kc">yes</span>
    <span class="k">else</span> <span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>On keyboard input, change the state of sprite 0, and check for action events to be handled.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">input: </span><span class="nf">(keys) -&gt;</span>
    <span class="k">if</span> <span class="nx">@currscene</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">state</span> <span class="o">is</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">state</span> <span class="o">and</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">down</span><span class="p">.</span><span class="nx">state</span> <span class="o">is</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">up</span><span class="p">.</span><span class="nx">state</span> <span class="k">then</span> <span class="nx">@currscene</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">mode = </span><span class="mi">0</span> <span class="k">else</span>
        <span class="nx">@currscene</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">mode = </span><span class="k">if</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">run</span><span class="p">.</span><span class="nx">state</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="nx">@currscene</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">vector</span><span class="p">.</span><span class="nx">set</span> <span class="s2">&quot;kbd&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">vect</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">state</span> <span class="o">-</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">state</span><span class="p">,</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">down</span><span class="p">.</span><span class="nx">state</span> <span class="o">-</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">up</span><span class="p">.</span><span class="nx">state</span>
      <span class="k">if</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">act</span><span class="p">.</span><span class="nx">poll</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">scene</span> <span class="k">in</span> <span class="nx">@currscene</span> <span class="k">when</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">interact</span> <span class="k">then</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">dointeract</span> <span class="nx">@currscene</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="kc">yes</span>
    <span class="k">else</span> <span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Gather and return data to be saved.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">savestate: </span><span class="o">-&gt;</span> <span class="k">if</span> <span class="nx">@currscene</span> <span class="o">isnt</span> <span class="mi">0</span> <span class="k">then</span> <span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">savestate</span><span class="p">()</span> <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">@currscene</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Distribute saved data into the sprite list.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">loadstate: </span><span class="nf">(state) -&gt;</span> <span class="k">if</span> <span class="nx">@currscene</span> <span class="o">isnt</span> <span class="mi">0</span> <span class="k">then</span> <span class="p">(</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">loadstate</span> <span class="nx">state</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">for</span> <span class="nx">sprite</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@currscene</span><span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 